# Распределенный вычислитель арифметических выражений

-----

**Содержание**

- [Описание проекта](#описание)
- [Архитектура](#архитектура)
- [Структура](#структура)
- [Оркестратор](#оркестратор)
- [Агент](#агент)
- [Запуск](#запуск)
- [Примеры](#примеры)





## Описание
Проект по разработе распределенного вычислителя арифметических выражений. Проект является продолжением предыдущего сервиса "веб-калькулятор" и предназначен для расчета арифметических выражений. 

Пользователь вводит строку арифметического выражения, например 2 + 2 * 2 и хочет получить в ответ 6. Арифметическое выражение может содержать цифры, знаки сложения, знаки вычитания, знаки умножения и знаки деления. Для установки приоритета выполнения части выражения используются "круглые" скобки.

В данном проекте мы иммитируем сложные и громоздкие вычисления, поэтому любая операция: сложения, вычитания, умножения и деления выполняются долго. 

Поэтому каждое арифметическое действие выполняется отдельно, что позволяет горизонтально или вертикально масштабировать систему. Пользователь может с какой-то периодичностью уточнять у сервера "не посчиталось ли выражение"? Если выражение наконец будет вычислено - то он получит результат. 

## Архитектура

Back-end часть

Состоит из 2 элементов:

    Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения. Далее будем называть его оркестратором.
    Вычислитель, который может получить от оркестратора задачу, выполнить его и вернуть серверу результат. Далее будем называть его агентом.


## Структура
Проект состоит из файлов и папок: 

    - cmd/main - основной файл проекта
    - cmd/main_test - тесты 
    - service/service - сервис расчета выражений
    - README.MD - описание проекта


## Оркестратор
Сервер, который имеет следующие endpoint-ы:

    Добавление вычисления арифметического выражения

    curl --location 'localhost/api/v1/calculate' \
    --header 'Content-Type: application/json' \
    --data '{
      "expression": <строка с выражение>
    }'

Коды ответа: 201 - выражение принято для вычисления, 422 - невалидные данные, 500 - что-то пошло не так

Тело ответа

{
    "id": <уникальный идентификатор выражения>
}

    Получение списка выражений

    curl --location 'localhost/api/v1/expressions'

Тело ответа

{
    "expressions": [
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        },
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        }
    ]
}

Коды ответа:

    200 - успешно получен список выражений

    500 - что-то пошло не так

    Получение выражения по его идентификатору

    curl --location 'localhost/api/v1/expressions/:id'

Коды ответа:

    200 - успешно получено выражение
    404 - нет такого выражения
    500 - что-то пошло не так

Тело ответа

{
    "expression":
        {
            "id": <идентификатор выражения>,
            "status": <статус вычисления выражения>,
            "result": <результат выражения>
        }
}

    Получение задачи для выполнения

    curl --location 'localhost/internal/task'

Коды ответа:

    200 - успешно получена задача
    404 - нет задачи
    500 - что-то пошло не так

Тело ответа

{
    "task":
        {
            "id": <идентификатор задачи>,
            "arg1": <имя первого аргумента>,
            "arg2": <имя второго аргумента>,
            "operation": <операция>,
            "operation_time": <время выполнения операции>
        }
}

    Прием результата обработки данных.

    curl --location 'localhost/internal/task' \
    --header 'Content-Type: application/json' \
    --data '{
      "id": 1,
      "result": 2.5
    }'

Коды ответа:

    200 - успешно записан результат
    404 - нет такой задачи
    422 - невалидные данные
    500 - что-то пошло не так


## Запуск
### Запуск проекта
Для установки проекта нужно клонировать папку проекта с github.com:
    
    git clone https://github.com/Zam62/sprint-2-final-task.git

Для запуска сервера нужно перейти в рабочую директорию проекта и выполнить запуск основного файла проекта:

    go run ./cmd/main.go
    
   

### Запуск тестов
Для запуска тестов необходимо перейти в папку cmd и выполнить запуск тестов:

    cd cmd/
    go test -v -timeout 30s ./cmd ./service/


## Примеры
### Сценарии использования

http://localhost:8080/api/v1/calculate

У сервиса один endpoint с url-ом .../api/v1/calculate. Пользователь отправляет на этот url POST-запрос с телом:

    {
        "expression": "выражение, которое ввёл пользователь"
    }

Для того, чтобы отправить запрос можно использовать Postman или curl. Пример вызова API с помощью утилиты curl:

    curl --location 'localhost:8080/api/v1/calculate' \
    --header 'Content-Type: application/json' \
    --data '{
      "expression": "2+2*2"
    }'

Пример вызова из Postman:
![Пример вызова из Postman](docs/postman_sample.png)   


### Варианты ответов сервиса
В ответ пользователь получает HTTP-ответ с телом:

{
    "result": "результат выражения"
}

и кодом 200, если выражение вычислено успешно, либо HTTP-ответ с телом:

{
    "error": "Expression is not valid"
}

и кодом 422, если входные данные не соответствуют требованиям приложения — например, кроме цифр и разрешённых операций пользователь ввёл символ английского алфавита.

Ещё один вариант HTTP-ответа:

{
    "error": "Internal server error"
}

и код 500 в случае какой-либо иной ошибки («Что-то пошло не так»).
